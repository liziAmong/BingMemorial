<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🐰ASMR 음성 가챠</title>
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      margin: 20px auto;
      max-width: 700px;
      padding: 0 10px;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      transition: background 0.8s ease;
    }
    
.gacha-box {
  transition: background-color 0.6s ease, color 0.6s ease, opacity 0.6s ease;
  opacity: 1;
}

.gacha-box.fadeout {
  opacity: 0;
  transition: opacity 0.6s ease;
}
    
    /* 슬라이드별 배경색 */
body.bg1  { background: linear-gradient(135deg, #5b5b78, #eac6d9); }   /* 어두운 쪽빛 → 연핑크 */
body.bg2  { background: linear-gradient(135deg, #7a5252, #f5c9d5); }   /* 브라운레드 → 밝은 핑크 */
body.bg3  { background: linear-gradient(135deg, #fefefe, #f6d5e0); }   /* 흰색 → 로즈핑크 */
body.bg4  { background: linear-gradient(135deg, #cccccc, #f7d2e3); }   /* 회색 → 밝은 핑크 */
body.bg5  { background: linear-gradient(135deg, #fff1d8, #fbcfe8); }   /* 크림톤 → 연핑크 */
body.bg6  { background: linear-gradient(135deg, #f5d7c7, #ffd6e7); }   /* 베이지핑크 → 연핑크 */
body.bg7  { background: linear-gradient(135deg, #a6d6f2, #ffe0f0); }   /* 스카이블루 → 라이트핑크 */
body.bg8  { background: linear-gradient(135deg, #4b607c, #ffddee); }   /* 네이비그레이 → 소프트핑크 */
body.bg9  { background: linear-gradient(135deg, #b0b0b0, #f2cdd9); }   /* 중간회색 → 채도낮은 핑크 */
body.bg10 { background: linear-gradient(135deg, #cd8c70, #f5d3de); }   /* 브릭 → 핑크 */
body.bg11 { background: linear-gradient(135deg, #e0d5b9, #ffd1e6); }   /* 빈티지톤 → 부드러운 핑크 */
body.bg12 { background: linear-gradient(135deg, #f0aac9, #fce4ec); }   /* 진핑크 → 연핑크 */
body.bg13 { background: linear-gradient(135deg, #5f7193, #f9d3ea); }   /* 쪽빛 → 연핑크 */
body.bg14 { background: linear-gradient(135deg, #b8e6f7, #ffd5e7); }   /* 파스텔블루 → 연핑크 */
body.bg15 { background: linear-gradient(135deg, #ffd6dc, #fff0f6); }   /* 살구핑크 → 흰핑크 */
body.bg16 { background: linear-gradient(135deg, #aecce3, #f2ccd9); }   /* 중하늘 → 부드러운 핑크 */
body.bg17 { background: linear-gradient(135deg, #b18b7e, #e8b7c9); }   /* 브라운핑크 → 로즈핑크 */
body.bg18 { background: linear-gradient(135deg, #a8d0d6, #fdd7e7); }   /* 민트블루 → 연핑크 */
body.bg19 { background: linear-gradient(135deg, #555577, #f1bfd6); }   /* 쿨네이비 → 밝은 핑크 */
body.bg20 { background: linear-gradient(135deg, #e6d7d1, #e8bcd0); }   /* 베이지핑크 → 채도낮은 핑크 */

    /* 가챠 희귀도별 배경 */
    body.normal-bg {
      background: linear-gradient(to bottom, #ffe6f0, #e0f7ff);
    }
    body.rare-bg {
      background: linear-gradient(to bottom, #a1c4fd, #c2e9fb);
    }
    body.special-bg {
      background: linear-gradient(to bottom, #ff9a9e, #fecfef);
    }

    /* 이하 기존 스타일 유지 */
    .slider-container {
      width: 100%;
      text-align: center;
      margin-top: 20px;
    }
    #main-image {
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 auto 15px auto;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      cursor: pointer;
    }
    #image-title {
      margin-top: 10px;
      font-size: 1.2rem;
      font-weight: 700;
      color: #d81b60;
      text-align: center;
      user-select: none;
      min-height: 28px;

    text-shadow:
    -1px -1px 0 #fff,
    1px -1px 0 #fff,
    -1px 1px 0 #fff,
    1px 1px 0 #fff;
    }
    #easter-egg-click-counter {
      display: none !important;
    }
    .controls {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 15px;
    }
    button {
      background-color: #ffb6c1;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      font-weight: bold;
      min-width: 100px;
    }
    button:hover:not(:disabled) {
      background-color: #ff69b4;
      transform: scale(1.05);
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .gacha-box {
      margin: 20px auto;
      min-height: 60px;
      font-size: 1.8rem;
      font-weight: bold;
      padding: 12px 20px;
      border-radius: 18px;
      transition: all 0.4s ease;
    }
    .rarity-normal {
      background-color: #f0f0f0;
      color: #555;
    }
    .rarity-rare {
      background-color: #87cefa;
      color: white;
      animation: rarity-flash 1s ease-in-out;
      box-shadow: 0 0 15px 3px #64b5f6;
    }
    .rarity-special {
      background-color: #ff69b4;
      color: white;
      animation: rarity-flash 1s ease-in-out;
      box-shadow: 0 0 20px 4px #ff4081;
    }
    @keyframes rarity-flash {
      0% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); }
    }
    .home-link {
      margin: 30px auto;
      text-align: center;
    }
    .home-link button {
      background-color: #ffb6c1;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 12px;
    }
    #easter-egg-player {
      display: none;
      margin-top: 15px;
      padding: 10px;
      border: 2px dashed #ff8be7;
      background: #fff0fb;
      border-radius: 12px;
      animation: sparkle 1s ease-out infinite alternate;
      text-align: center;
      user-select: none;
    }
    #easter-egg-player button {
      background-color: #ff85c1;
      border-radius: 12px;
      border: none;
      color: white;
      padding: 8px 14px;
      margin: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #easter-egg-player button:hover {
      background-color: #ff3a85;
    }
    @keyframes sparkle {
      0% { box-shadow: 0 0 5px #ffb3ec; }
      100% { box-shadow: 0 0 20px #ff6fd8; }
    }
    /* 미니 플레이어 관련 스타일 */
    #mini-player {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 520px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1000;
      padding: 12px 16px;
      display: none;
      flex-direction: column;
      gap: 6px;
    }
    .mini-player-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .mini-player-controls {
      display: flex;
      gap: 10px;
    }
    #mini-player-title {
      flex: 2;
      font-weight: 900;
      font-size: 0.8rem;
      color: #d81b60;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #progress-bar {
      flex: 2;
      -webkit-appearance: none;
      height: 5px;
      background: #ff69b4;
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }
    #volume-bar {
      width: 100%;
      -webkit-appearance: none;
      height: 5px;
      background: #aaa;
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }
    #progress-bar::-webkit-slider-thumb,
    #volume-bar::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    @media (max-width: 768px) {
      body {
        padding: 0 15px;
        font-size: 15px;
      }
      .controls {
        flex-direction: column;
        gap: 10px;
      }
      #mini-player {
        padding: 10px;
      }
      .mini-player-content {
        flex-direction: column;
        align-items: stretch;
      }
      .mini-player-controls {
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body class="bg1" oncontextmenu="return false">
  <div class="slider-container">
    <img id="main-image" src="images/image1.jpg" alt="슬라이드 이미지" />
    <div id="image-title">들어오세요 하유</div>
    <div id="easter-egg-click-counter">0 / 13</div>
    <div id="gacha-box" class="gacha-box rarity-normal">-</div>
<div id="probability-boost-msg" style="margin-top: 8px; color: #ff4081; font-weight: bold; display: none;">
  🔥 확률 업 적용 중!
</div>
    <div class="controls">
      <button id="sound-btn">🎲 가챠 돌리기</button>
      <button id="prev-btn">◀ 이전</button>
      <div id="counter">1 / 20</div>
      <button id="next-btn">다음 ▶</button>
    </div>
  </div>

  <div class="home-link">
    <a href="index.html"><button>🏠 메인으로 돌아가기</button></a>
  </div>

  <!-- 이스터에그 음성 플레이어 -->
  <div id="easter-egg-player">
    <p>🌟 이스터에그 발견! 원하는 음성을 들어보세요:</p>
    <button data-type="normal">노말 음성</button>
    <button data-type="rare">레어 음성</button>
    <button data-type="special">스페셜 음성</button>
  </div>

  <div id="mini-player">
    <div class="mini-player-content">
      <div id="mini-player-title">🔊 재생 중...</div>
      <input type="range" id="progress-bar" value="0" step="1" min="0" max="100" />
      <div class="mini-player-controls">
        <button id="pause-btn">⏸️</button>
        <button id="close-btn">❌</button>
      </div>
    </div>
    <input type="range" id="volume-bar" min="0" max="1" step="0.01" value="1" />
  </div>

  <script>
    // 우클릭, 복사, 붙여넣기, 개발자도구 단축키 방지
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('paste', e => e.preventDefault());
    document.addEventListener('keydown', function (e) {
      if (
        e.key === 'F12' ||
        (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key.toUpperCase())) ||
        (e.ctrlKey && e.key.toUpperCase() === 'U')
      ) {
        e.preventDefault();
      }
    });

    const totalItems = 20;
    let lastRarity = null;
    let sameRarityCount = 0;
    let probabilityBoostActive = false;
    const probabilityBoostMsg = document.getElementById("probability-boost-msg");

    function getRarityWithProbabilityBoost() {
      let baseRandom = Math.random();
      let rarity = "normal";

      if (sameRarityCount >= 3) {
        probabilityBoostActive = true;
        probabilityBoostMsg.style.display = "block";

        if (baseRandom < 0.25) {
          rarity = "special";   // 25%
        } else if (baseRandom < 0.60) {
          rarity = "rare";      // 35%
        } else {
          rarity = "normal";    // 40%
        }
      } else {
        probabilityBoostActive = false;
        probabilityBoostMsg.style.display = "none";

        if (baseRandom < 0.20) {
          rarity = "special";   // 20%
        } else if (baseRandom < 0.50) {
          rarity = "rare";      // 30%
        } else {
          rarity = "normal";    // 50%
        }
      }
      return rarity;
    }

    let currentIndex = 0;
    const imageElement = document.getElementById("main-image");
    const gachaBox = document.getElementById("gacha-box");
    const soundButton = document.getElementById("sound-btn");
    const counter = document.getElementById("counter");
    const miniPlayer = document.getElementById("mini-player");
    const progressBar = document.getElementById("progress-bar");
    const volumeBar = document.getElementById("volume-bar");
    const pauseBtn = document.getElementById("pause-btn");
    const closeBtn = document.getElementById("close-btn");
    const miniTitle = document.getElementById("mini-player-title");

    const eggClickCounter = document.getElementById("easter-egg-click-counter");
    const eggPlayer = document.getElementById("easter-egg-player");

    const images = Array.from({ length: totalItems }, (_, i) => `images/image${i + 1}.jpg`);
    const sounds = Array.from({ length: totalItems }, (_, i) => ({
      normal: `sounds/sound${i + 1}_1.mp3`,
      rare: `sounds/sound${i + 1}_2.mp3`,
      special: `sounds/sound${i + 1}_special.mp3`,
    }));

    const titles = [
      "들어오세요 하유",
      "사탕물어요 하유",
      "어제어땠어 하유",
      "오피스바닥 하유",
      "오피스선배 하유",
      "미시일루왓 하유",
      "커피데이트 하유",
      "노말타입임 하유",
      "남친셔츠당 하유",
      "송편드세요 하유",
      "라디오에요 하유",
      "바니잠옷임 하유",
      "고스트짜잔 하유",
      "손꼭잡은낮 하유",
      "손꼭잡은밤 하유",
      "무릎강조중 하유",
      "산타입니다 하유",
      "푸른뱀이당 하유",
      "진짜노말임 하유",
      "마지막특별하유"
    ];

    // 배경색 바꾸기 함수
    function updateBackground(index) {
      document.body.className = ''; // 기존 클래스 제거
      document.body.classList.add(`bg${index + 1}`);
    }

    // 이미지, 타이틀, 배경, 카운터 업데이트
    function updateDisplay(index) {
      imageElement.src = images[index];
      imageElement.alt = titles[index];
      document.getElementById("image-title").textContent = titles[index];
      counter.textContent = `${index + 1} / ${totalItems}`;
      updateBackground(index);
    }

    // 좌우 버튼
    document.getElementById("prev-btn").addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + totalItems) % totalItems;
      updateDisplay(currentIndex);
      resetGachaBox();
    });

    document.getElementById("next-btn").addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % totalItems;
      updateDisplay(currentIndex);
      resetGachaBox();
    });

    // 이스터에그 클릭 카운터 (20번 이미지에서만 카운트)
    let eggClickCount = 0;
    const eggClickThreshold = 13;

    imageElement.addEventListener("click", () => {
      if (currentIndex === 19) { // 20번째 이미지 index = 19
        eggClickCount++;
        eggClickCounter.textContent = `${eggClickCount} / ${eggClickThreshold}`;
        eggClickCounter.style.display = "block";

        if (eggClickCount >= eggClickThreshold) {
          eggPlayer.style.display = "block";
        }
      }
    });

    // 가챠 버튼 클릭 시 실행 함수
    function gachaButtonHandler() {
      let rarity = getRarityWithProbabilityBoost();

      if (rarity === lastRarity) {
        sameRarityCount++;
      } else {
        sameRarityCount = 1;
        lastRarity = rarity;
      }

      // 사운드 경로
      const soundPath = sounds[currentIndex][rarity];
      playAudio(soundPath);

      // 가챠 박스 텍스트 및 스타일 변경
      gachaBox.textContent = rarity.toUpperCase();
      gachaBox.className = "gacha-box";

      if (rarity === "normal") {
        gachaBox.classList.add("rarity-normal");
        document.body.className = `bg${currentIndex + 1} normal-bg`;
      } else if (rarity === "rare") {
        gachaBox.classList.add("rarity-rare");
        document.body.className = `bg${currentIndex + 1} rare-bg`;
      } else if (rarity === "special") {
        gachaBox.classList.add("rarity-special");
        document.body.className = `bg${currentIndex + 1} special-bg`;
      }

      // 확률업 메시지 노출 여부는 getRarityWithProbabilityBoost() 내에서 처리
    }

    // 가챠 박스 텍스트 초기화 함수
    function resetGachaBox() {
      gachaBox.textContent = "-";
      gachaBox.className = "gacha-box rarity-normal";
      probabilityBoostMsg.style.display = "none";
    }

    // 사운드 재생 및 미니플레이어 제어 변수
    let audio = null;
    let isPaused = false;

    // 오디오 재생 함수
    function playAudio(src) {
      if (audio) {
        audio.pause();
        audio = null;
      }
      audio = new Audio(src);
      audio.volume = volumeBar.value;
      audio.play();

      // 미니 플레이어 보이기
      miniPlayer.style.display = "flex";
      miniTitle.textContent = titles[currentIndex] + ` (${src.includes("special") ? "스페셜" : src.includes("2") ? "레어" : "노말"})`;

      // 프로그레스바 업데이트
      audio.addEventListener("loadedmetadata", () => {
        progressBar.max = Math.floor(audio.duration);
        progressBar.value = 0;
      });

      audio.addEventListener("timeupdate", () => {
        if (!isPaused) {
          progressBar.value = Math.floor(audio.currentTime);
        }
      });

      audio.addEventListener("ended", () => {
        miniPlayer.style.display = "none";
      });
    }

    // 미니 플레이어 컨트롤 이벤트
    pauseBtn.addEventListener("click", () => {
      if (!audio) return;
      if (audio.paused) {
        audio.play();
        pauseBtn.textContent = "⏸️";
        isPaused = false;
      } else {
        audio.pause();
        pauseBtn.textContent = "▶️";
        isPaused = true;
      }
    });

    closeBtn.addEventListener("click", () => {
      if (audio) {
        audio.pause();
        audio = null;
      }
      miniPlayer.style.display = "none";
    });

    progressBar.addEventListener("input", () => {
      if (audio) {
        audio.currentTime = progressBar.value;
      }
    });

    volumeBar.addEventListener("input", () => {
      if (audio) {
        audio.volume = volumeBar.value;
      }
    });

    // 이스터에그 플레이어 버튼 클릭 이벤트
    eggPlayer.querySelectorAll("button").forEach(btn => {
      btn.addEventListener("click", () => {
        const type = btn.getAttribute("data-type");
        const eggAudioPath = sounds[19][type]; // 20번째 이미지 음성

        playAudio(eggAudioPath);
      });
    });

    // 초기 화면 업데이트
    updateDisplay(currentIndex);
    resetGachaBox();

    // 가챠 버튼 이벤트 등록
    soundButton.addEventListener("click", gachaButtonHandler);
  </script>
</body>
</html>
